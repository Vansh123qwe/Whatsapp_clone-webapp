{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <title>{%block title%} {% endblock %}</title>

  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->

 
 <style>
{%block css%} 
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: -34px;

}

{%endblock css%}
</style>





<script>


function myfunction(name)
{
//$(document).on('submit' ,function(e){
 // e.preventDefault();
// var elem= document.getElementById(name)
// elem.classList.add("active")
setInterval(function() {
  $.ajax({
        type:'POST',
        url:'{% url "name" 1234 %}'.replace(/1234/, name),
        data:{
            //username:tmp,
            //csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
            action: 'post'
        },
        success:function(json){
              
           // document.getElementById("qwe").parentNode.reset();
           var result = document.getElementById("qwe");
          // var resul = document.getElementById("asq");
          // var resu = document.getElementById("tt");
         //  var res = document.getElementById("qq");
            // console.log(result);
             result.innerHTML="";
        /*    for(int i=0; i< Object.keys(json).length; i++) 
            {    
             result.innerHTML = json[i].body ;
             resul.innerHTML = json[i+1].body ;
             resu.innerHTML = json[i].time ;
             res.innerHTML = json[i+1].time ;
            }*/
              var i;
            for( i=0; i< Object.keys(json).length; i++){
                if(json[i].who==name)
                {
                  result.innerHTML+=`<div class="incoming_msg">
          <div class="incoming_msg_img"> <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="sunil"> </div>
          <div class="received_msg">
            <div class="received_withd_msg">
              <p>` + json[i].body + `</p>
              <span class="time_date">`+ json[i].time + `</span></div>
          </div>
        </div>`
                }
                else{
                  result.innerHTML+= `<div class="outgoing_msg">
          <div class="sent_msg">
            <p>`+ json[i].body +`</p> 
           <span class="time_date">`+ json[i].time + `</span> </div>
        </div>`
                } 
              }    
      
        },

  
        
     
        error : function(xhr,errmsg,err) {
          //console.log("happy4");
        console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
    
        
        
    }
    });
    

    var result1 = document.getElementById("qwe");
        result1.scrollTop = result1.scrollHeight;
  //  });

        }, 1000);
      

       
       
      }

// $.ajax({
//         type:'POST',
//         url:'{% url "name" 1234 %}'.replace(/1234/, name),
//         data:{
//             //username:tmp,
//             //csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
//             action: 'post'
//         },
//         success:function(json){
//               console.log(json);
//            // document.getElementById("qwe").parentNode.reset();
//            var result = document.getElementById("qwe");
//           // var resul = document.getElementById("asq");
//           // var resu = document.getElementById("tt");
//          //  var res = document.getElementById("qq");
//             // console.log(result);
//              result.innerHTML="";
//         /*    for(int i=0; i< Object.keys(json).length; i++) 
//             {    
//              result.innerHTML = json[i].body ;
//              resul.innerHTML = json[i+1].body ;
//              resu.innerHTML = json[i].time ;
//              res.innerHTML = json[i+1].time ;
//             }*/
//               var i;
//             for( i=0; i< Object.keys(json).length; i++){
//                 if(json[i].who==name)
//                 {
//                   result.innerHTML+=`<div class="incoming_msg">
//           <div class="incoming_msg_img"> <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="sunil"> </div>
//           <div class="received_msg">
//             <div class="received_withd_msg">
//               <p>` + json[i].body + `</p>
//               <span class="time_date">`+ json[i].time + `</span></div>
//           </div>
//         </div>`
//                 }
//                 else{
//                   result.innerHTML+= `<div class="outgoing_msg">
//           <div class="sent_msg">
//             <p>`+ json[i].body +`</p> 
//            <span class="time_date">`+ json[i].time + `</span> </div>
//         </div>`
//                 } 
//               }    
      
//         },



        
//         error : function(xhr,errmsg,err) {
//           //console.log("happy4");
//         console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
    

//     }
//     });
//   //  });




</script>

  </head>



  <body>
    
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="#">Adbhut</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="/home">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/about">Messages</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
      </li>
    </ul>
    <form action="/users" method="post" class="form-inline my-2 my-lg-0"> {% csrf_token %}
      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="query" id='query'>
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>

    </form>

  <div class="btn-group ml-2 mr-2">
  <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Welcome
  </button>
  <div class="dropdown-menu">
      <a class="dropdown-item" href="#"> {{request.user}} </a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="/logout">Logout</a>
  
</div>

  </div>
</nav>
 {% for message in messages  %}            
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            <strong>Message : </strong> {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
      {% endfor %} 

  
{%block body%}


<footer class="container-fluid bg-dark my-0 py-3 text-light">
    <p class="mb-0 text-center">Â© 2020-2021 Adbhut Chat</p>
    <p class="mb-0 text-center">
      <a href="#">Back to top |</a>
      <a href="#">Privacy |</a>
      <a href="#">Terms</a>
    </p>

</footer>
   

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>

{%endblock body%}
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- Option 2: Separate Popper and Bootstrap JS -->


    <!--
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
    -->
  </body>
</html>